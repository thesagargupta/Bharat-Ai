(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37115,e=>{"use strict";e.s(["default",()=>I],37115);var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(17255),n=e.i(92199);function l(e){let{isOpen:s,onClose:r,imageUrl:l,imageData:i={}}=e,[o,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=e=>{s&&"Escape"===e.key&&r()};return s&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[s,r]);let c=async()=>{try{let e=await fetch(l),t=await e.blob(),a=window.URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download="bharat-ai-generated-".concat(Date.now(),".png"),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(a)}catch(e){console.error("Download failed:",e),window.open(l,"_blank")}};return s?(console.log("ImageModal rendering with:",{isOpen:s,imageUrl:l}),(0,t.jsxs)("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center",style:{zIndex:9999},children:[(0,t.jsxs)("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 bg-black/50 rounded-lg px-3 py-2 text-white",children:(0,t.jsx)("span",{className:"text-sm font-medium",children:"Generated Image"})}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-1 bg-black/50 rounded-lg p-1",children:[(0,t.jsx)("button",{onClick:c,className:"p-2 text-white hover:bg-white/20 rounded transition-colors",title:"Download Image",children:(0,t.jsx)(n.FiDownload,{size:18})}),(0,t.jsx)("button",{onClick:r,className:"p-2 text-white hover:bg-red-500/20 rounded transition-colors",title:"Close (Esc)",children:(0,t.jsx)(n.FiX,{size:18})})]})})]}),(0,t.jsx)("div",{className:"relative flex items-center justify-center w-full h-full p-4 pt-20 pb-16",onClick:e=>e.target===e.currentTarget&&r(),children:(0,t.jsxs)("div",{className:"relative max-w-full max-h-full overflow-hidden",children:[(0,t.jsx)("img",{src:l,alt:"Generated image",className:"max-w-[90vw] max-h-[70vh] object-contain cursor-pointer",onLoad:()=>d(!1),onDoubleClick:r,draggable:!1}),o&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20",children:(0,t.jsx)("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"})})]})}),(0,t.jsxs)("div",{className:"absolute bottom-4 right-4 bg-black/50 rounded-lg px-3 py-2 text-white text-xs opacity-75",children:[(0,t.jsx)("kbd",{className:"bg-white/20 px-1 rounded mr-1",children:"Esc"}),"Close",(0,t.jsx)("span",{className:"ml-2",children:"Double-click to close"})]})]})):null}var i=e.i(40141);function o(e){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"},child:[]}]})(e)}var d=e.i(57688);function c(e){let{isOpen:a,onClose:s,chats:r,currentChatId:l,onNewChat:i,onSelectChat:c,onDeleteChat:m,onOpenSettings:u}=e;return(0,t.jsxs)(t.Fragment,{children:[a&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:s}),(0,t.jsxs)("div",{className:"fixed lg:static inset-y-0 left-0 z-50 w-80 bg-white border-r border-gray-200 flex flex-col transform transition-transform duration-300 ease-in-out lg:translate-x-0 ".concat(a?"translate-x-0":"-translate-x-full"),children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"relative group",children:(0,t.jsx)("div",{className:"relative bg-white rounded-full p-2 shadow-lg",children:(0,t.jsx)(d.default,{src:"/logo.png",alt:"Bharat AI Logo",width:40,height:40,className:"rounded-full"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-semibold text-gray-900",children:"Bharat AI"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"AI Assistant"})]})]}),(0,t.jsx)("button",{onClick:s,className:"lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Close menu",children:(0,t.jsx)(n.FiX,{size:24,className:"text-gray-700"})})]})}),(0,t.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto",children:[(0,t.jsxs)("button",{onClick:i,className:"w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-3 text-gray-700 mb-2",style:{fontWeight:500},children:[(0,t.jsx)(n.FiMessageSquare,{size:16}),(0,t.jsx)("span",{className:"text-sm",children:"New Chat"})]}),(0,t.jsx)("div",{className:"border-t border-gray-200 my-2",style:{height:"1px"}}),(0,t.jsxs)("div",{className:"space-y-1",children:[0===r.length&&(0,t.jsx)("div",{className:"text-xs text-gray-400 px-2 py-2",children:"No chats yet"}),r.filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id)).map(e=>(0,t.jsxs)("div",{className:"flex items-center group rounded-lg px-2 py-2 cursor-pointer ".concat(l===e.id?"bg-gray-100 border border-gray-200":"hover:bg-gray-50"),onClick:()=>c(e.id),style:{transition:"background 0.2s"},children:[(0,t.jsxs)("div",{className:"flex-1 truncate",children:[(0,t.jsx)("span",{className:"text-sm text-gray-800 font-medium truncate",children:e.title||"New Chat"}),(0,t.jsx)("div",{className:"text-xs text-gray-500 truncate mt-1",children:e.lastMessage})]}),(0,t.jsx)("button",{className:"ml-2 p-1 rounded md:hover:bg-gray-200 text-gray-500 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity",title:"Delete chat",onClick:t=>{t.stopPropagation(),m(e.id)},children:(0,t.jsx)(o,{size:16})})]},e.id))]})]}),(0,t.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,t.jsxs)("button",{onClick:u,className:"w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-3 text-gray-700",children:[(0,t.jsx)(n.FiSettings,{size:18}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Settings"})]})})]})]})}function m(e){return(0,i.GenIcon)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 11h12v2H4zm0-5h16v2H4zm0 12h7.235v-2H4z"},child:[]}]})(e)}function u(e){let{onMenuClick:a,onProfileClick:s,userAvatar:r,userName:l}=e;return(0,t.jsx)("div",{className:"bg-white border-b border-gray-200 px-4 sm:px-6 py-3 sm:py-4 flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:a,className:"lg:hidden p-2 hover:bg-gray-100 rounded-lg transition-colors","aria-label":"Open menu",children:(0,t.jsx)(m,{size:24,className:"text-gray-700"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Chat with Bharat AI"}),(0,t.jsx)("p",{className:"text-xs sm:text-sm text-gray-500",children:"Online now"})]})]}),(0,t.jsx)("button",{onClick:s,className:"relative hover:opacity-80 transition-opacity group",title:"View Profile",children:r?(0,t.jsx)("div",{className:"relative w-10 h-10 rounded-full overflow-hidden border-2 border-gray-200 group-hover:border-blue-500 transition-colors bg-gray-100",children:(0,t.jsx)("img",{src:r,alt:l||"User",className:"w-full h-full object-cover",loading:"lazy",referrerPolicy:"no-referrer"},r)}):(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center border-2 border-gray-200 group-hover:border-blue-500 transition-colors",children:(0,t.jsx)(n.FiUser,{size:20,className:"text-white"})})})]})})}function h(){return(0,t.jsx)("div",{className:"flex items-center justify-center h-full min-h-[300px] md:min-h-[400px] px-4",style:{zoom:"0.8"},children:(0,t.jsxs)("div",{className:"text-center max-w-4xl mx-auto py-4 md:py-8 animate-fadeIn w-full",children:[(0,t.jsxs)("div",{className:"mb-6 md:mb-8 relative",children:[(0,t.jsx)("div",{className:"w-16 h-16 md:w-20 md:h-20 mx-auto bg-gradient-to-br from-orange-500 via-yellow-600 to-green-600 rounded-2xl md:rounded-3xl flex items-center justify-center shadow-xl md:shadow-2xl transform hover:scale-105 transition-transform duration-300",children:(0,t.jsx)(d.default,{src:"/world.svg",alt:"Bharat AI Logo",width:40,height:40,className:"w-8 h-8 md:w-10 md:h-10"})}),(0,t.jsx)("div",{className:"absolute inset-0 w-16 h-16 md:w-20 md:h-20 mx-auto border-4 border-blue-200 rounded-2xl md:rounded-3xl animate-ping opacity-20"})]}),(0,t.jsx)("h1",{className:"text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent animate-gradient px-4",children:"Welcome to Bharat AI"}),(0,t.jsx)("p",{className:"text-lg sm:text-xl md:text-2xl text-gray-600 mb-6 md:mb-8 font-medium px-4",children:"How can I help you today?"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4 mt-6 md:mt-12 max-w-5xl mx-auto px-2",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 border border-blue-200 rounded-xl md:rounded-2xl p-4 md:p-6 hover:shadow-lg transition-all duration-300 cursor-pointer group hover:scale-105",children:[(0,t.jsx)("div",{className:"mb-2 md:mb-3 text-blue-600 group-hover:scale-110 transition-transform flex justify-center",children:(0,t.jsx)(n.FiMessageSquare,{className:"w-6 h-6 md:w-8 md:h-8"})}),(0,t.jsx)("h3",{className:"font-semibold text-gray-800 mb-1 md:mb-2 text-sm md:text-base",children:"Get instant answers"}),(0,t.jsx)("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Ask me anything and get intelligent responses"})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-200 rounded-xl md:rounded-2xl p-4 md:p-6 hover:shadow-lg transition-all duration-300 cursor-pointer group hover:scale-105",children:[(0,t.jsx)("div",{className:"mb-2 md:mb-3 text-purple-600 group-hover:scale-110 transition-transform flex justify-center",children:(0,t.jsx)(n.FiImage,{className:"w-6 h-6 md:w-8 md:h-8"})}),(0,t.jsx)("h3",{className:"font-semibold text-gray-800 mb-1 md:mb-2 text-sm md:text-base",children:"Generate images"}),(0,t.jsx)("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Create stunning AI-generated artwork"})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-teal-50 border border-green-200 rounded-xl md:rounded-2xl p-4 md:p-6 hover:shadow-lg transition-all duration-300 cursor-pointer group hover:scale-105",children:[(0,t.jsx)("div",{className:"mb-2 md:mb-3 text-green-600 group-hover:scale-110 transition-transform flex justify-center",children:(0,t.jsx)(n.FiUpload,{className:"w-6 h-6 md:w-8 md:h-8"})}),(0,t.jsx)("h3",{className:"font-semibold text-gray-800 mb-1 md:mb-2 text-sm md:text-base",children:"Analyze images"}),(0,t.jsx)("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Upload photos for AI-powered analysis"})]}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-orange-50 to-yellow-50 border border-orange-200 rounded-xl md:rounded-2xl p-4 md:p-6 hover:shadow-lg transition-all duration-300 cursor-pointer group hover:scale-105",children:[(0,t.jsx)("div",{className:"mb-2 md:mb-3 text-orange-600 group-hover:scale-110 transition-transform flex justify-center",children:(0,t.jsx)(n.FiSettings,{className:"w-6 h-6 md:w-8 md:h-8"})}),(0,t.jsx)("h3",{className:"font-semibold text-gray-800 mb-1 md:mb-2 text-sm md:text-base",children:"Smart conversations"}),(0,t.jsx)("p",{className:"text-xs md:text-sm text-gray-600 hidden sm:block",children:"Context-aware chat that remembers everything"})]})]}),(0,t.jsxs)("div",{className:"mt-8 md:mt-12 flex items-center justify-center gap-2 text-gray-400 text-xs md:text-sm",children:[(0,t.jsx)(n.FiSend,{className:"w-4 h-4 animate-bounce"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Start by typing a message below"}),(0,t.jsx)("span",{className:"sm:hidden",children:"Type a message to start"})]})]})})}let x=e=>{let{language:s,content:r}=e,[l,i]=(0,a.useState)(!1),o=async()=>{try{await navigator.clipboard.writeText(r),i(!0),setTimeout(()=>i(!1),2e3)}catch(e){console.error("Failed to copy code:",e)}};return(0,t.jsxs)("div",{className:"my-4 bg-gray-900 rounded-lg overflow-hidden border border-gray-700",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 border-b border-gray-700",children:[(0,t.jsx)("span",{className:"text-sm text-gray-300 font-medium",children:s}),(0,t.jsx)("button",{onClick:o,className:"flex items-center gap-2 px-3 py-1 text-sm text-gray-300 hover:text-white hover:bg-gray-700 rounded transition-colors",children:l?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.FiCheck,{size:14}),"Copied!"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.FiCopy,{size:14}),"Copy"]})})]}),(0,t.jsx)("div",{className:"p-4",children:(0,t.jsx)("pre",{className:"text-sm text-gray-100 overflow-x-auto whitespace-pre-wrap break-words",children:(0,t.jsx)("code",{children:r})})})]})};function g(e){var s;let{msg:r,userAvatar:l,onImageClick:i}=e,o="user"===r.role,d=(e=>{let t;if(!e)return[];let a=[],s=/```(\w+)?\n?([\s\S]*?)```/g,r=0;for(;null!==(t=s.exec(e));)t.index>r&&a.push({type:"text",content:e.slice(r,t.index)}),a.push({type:"code",language:t[1]||"text",content:t[2].trim()}),r=t.index+t[0].length;return r<e.length&&a.push({type:"text",content:e.slice(r)}),a.length>0?a:[{type:"text",content:e}]})(r.text||""),c=(s=r.image)?"string"==typeof s&&""!==s.trim()?s:"object"==typeof s&&s.url&&"string"==typeof s.url&&""!==s.url.trim()?s.url:null:null,[m,u]=(0,a.useState)(!1);return(0,t.jsx)("div",{className:"flex ".concat(o?"justify-end":"justify-start"," mb-6"),children:(0,t.jsxs)("div",{className:"flex items-start gap-3 max-w-[85%] ".concat(o?"flex-row-reverse":"flex-row"),children:[o&&l?(0,t.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full overflow-hidden border-2 border-blue-400 shadow-md",children:(0,t.jsx)("img",{src:l,alt:"User avatar",className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none",e.target.parentElement.innerHTML='<div class="w-full h-full bg-gradient-to-r from-blue-500 to-indigo-500 flex items-center justify-center"><svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div>'}})}):(0,t.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ".concat(o?"bg-gradient-to-r from-blue-500 to-indigo-500 text-white":"bg-gradient-to-r from-indigo-500 to-purple-500 text-white"),children:o?(0,t.jsx)(n.FiUser,{size:16}):(0,t.jsx)(n.FiCpu,{size:16})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 ".concat(o?"text-right":"text-left"),children:[(0,t.jsxs)("div",{className:"inline-block max-w-full px-5 py-3 rounded-2xl shadow-lg ".concat(o?"bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-br-md":d.some(e=>"code"===e.type)?"bg-transparent text-gray-800":"bg-white text-gray-800 border border-gray-100 rounded-bl-md"),children:[r.text&&(0,t.jsx)("div",{className:"text-sm leading-relaxed",children:d.map((e,s)=>"code"===e.type?(0,t.jsx)(x,{language:e.language,content:e.content},s):(0,t.jsx)("div",{className:"whitespace-pre-wrap break-words",children:e.content.split("\n").map((s,r)=>(0,t.jsxs)(a.default.Fragment,{children:[(e=>{let a;if(!e)return null;let s=[],r=0,n=/\*\*([^*\n]+?)\*\*/g;for(;null!==(a=n.exec(e));){let n=e.lastIndexOf("\n",a.index)+1,l=e.substring(n,a.index).trim();"*"!==l&&"-"!==l&&"â€¢"!==l&&(a.index>r&&s.push(e.slice(r,a.index)),s.push((0,t.jsx)("strong",{className:"font-bold text-gray-900 dark:text-white",children:a[1]},"bold-".concat(a.index))),r=a.index+a[0].length)}return r<e.length&&s.push(e.slice(r)),s.length>0?s:e})(s),r<e.content.split("\n").length-1&&(0,t.jsx)("br",{})]},r))},s))}),c&&!m&&(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsxs)("div",{className:"relative inline-block group",children:[(0,t.jsx)("img",{src:c,alt:"Generated or attached image",className:"w-full max-w-md max-h-64 object-cover rounded-xl border shadow-sm cursor-pointer hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02]",onError:e=>{u(!0),e.preventDefault()},onLoad:()=>{u(!1)},onClick:e=>{e.preventDefault(),e.stopPropagation(),i&&i(c)}}),(0,t.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 rounded-xl transition-all duration-200 flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,t.jsx)("div",{className:"bg-white/90 backdrop-blur-sm px-3 py-1.5 rounded-full text-xs font-medium text-gray-700 shadow-lg",children:"Click to view full size"})}),(0,t.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-all duration-200",children:(0,t.jsx)("button",{onClick:e=>{if(e.preventDefault(),e.stopPropagation(),c){let e=document.createElement("a");e.href=c,e.download="bharat-ai-image-".concat(Date.now(),".png"),e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)}},className:"bg-black/70 hover:bg-black/90 text-white p-2 rounded-full backdrop-blur-sm transition-all duration-200 shadow-lg",title:"Download image",children:(0,t.jsx)(n.FiDownload,{size:16})})})]})}),c&&m&&(0,t.jsx)("div",{className:"mt-3",children:(0,t.jsx)("div",{className:"bg-gray-100 border border-gray-300 rounded-xl px-4 py-3 text-sm text-gray-600",children:(0,t.jsxs)("p",{className:"flex items-center gap-2",children:[(0,t.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Image temporarily unavailable"]})})})]}),(0,t.jsx)("div",{className:"text-xs mt-2 ".concat(o?"text-gray-400":"text-gray-500"),children:o?"You":"Bharat AI"})]})]})})}function p(e){let{messages:a,isTyping:s,typingRef:r,lastMessageRef:n,messagesEndRef:l,scrollRef:i,onImageClick:o}=e,d=[],c=new Set;for(let e=a.length-1;e>=0;e--){let t=a[e];c.has(t.id)||(c.add(t.id),d.unshift(t))}return(0,t.jsxs)("div",{ref:i,className:"flex-1 overflow-y-auto overflow-x-hidden px-4 sm:px-6 py-4 space-y-4",style:{minHeight:0,WebkitOverflowScrolling:"touch"},children:[d.map((e,a)=>{let s=a===d.length-1&&"assistant"===e.role;return(0,t.jsx)("div",{className:"animate-fadeIn",ref:s?n:null,children:(0,t.jsx)(g,{msg:{role:e.role,text:e.content,image:e.image,id:e.id},onImageClick:o})},e.id)}),s&&(0,t.jsx)("div",{ref:r,className:"animate-fadeIn",children:(0,t.jsxs)("div",{className:"flex items-start space-x-3 mb-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-600 via-blue-600 to-indigo-600 ai-avatar-typing flex items-center justify-center flex-shrink-0 shadow-lg",children:(0,t.jsx)("svg",{className:"w-4 h-4 text-white animate-pulse",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})}),(0,t.jsx)("div",{className:"flex-1 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-700 rounded-2xl px-4 py-4 shadow-sm border border-gray-200 dark:border-gray-600",children:(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"flex space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full typing-dot"}),(0,t.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full typing-dot"}),(0,t.jsx)("div",{className:"w-2 h-2 bg-indigo-500 rounded-full typing-dot"})]}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-300",children:"BharatAI is thinking..."})]})})]})}),(0,t.jsx)("div",{ref:l,className:"h-1"})]})}function f(e){let{selected:a,onToggle:s,onUploadClick:r,onRemove:l,onExitImageGen:i}=e,o=[{id:"image-gen",label:"Generate Image",icon:(0,t.jsx)(n.FiImage,{})},{id:"upload",label:"Upload Image",icon:(0,t.jsx)(n.FiUpload,{})}];return(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsx)("div",{className:"flex gap-3 items-center mt-3",children:o.map(e=>{let n=a.includes(e.id);return(0,t.jsxs)("button",{onClick:t=>{t.preventDefault(),"upload"===e.id?r():s(e.id)},className:"flex items-center gap-2 px-3 py-2 rounded-full text-sm font-medium transition\n                ".concat(n?"bg-gradient-to-r from-indigo-500 to-blue-500 text-white shadow-lg":"bg-white text-gray-700 border","\n              "),children:[(0,t.jsx)("span",{className:"text-lg",children:e.icon}),(0,t.jsx)("span",{className:"hidden sm:inline",children:e.label})]},e.id)})}),(0,t.jsx)("div",{className:"mt-3 flex gap-2 items-center flex-wrap",children:a.map(e=>{let a="image-gen"===e?"Image Generation":"upload"===e?"Uploaded Image":e;return(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 rounded-full bg-indigo-50 text-indigo-700 text-sm",children:[(0,t.jsx)("span",{className:"text-sm",children:a}),(0,t.jsx)("button",{onClick:t=>{t.preventDefault(),"image-gen"===e&&i?i():l(e)},className:"p-1 rounded-full hover:bg-indigo-100",children:(0,t.jsx)(n.FiX,{})})]},e)})})]})}function b(e){let{message:a,setMessage:s,isTyping:r,isImageGenMode:l,selectedTools:i,uploadedPreview:o,fileRef:d,onSend:c,onToggleTool:m,onUploadClick:u,onRemoveTool:h,onExitImageGen:x,onFileChange:g}=e;return(0,t.jsxs)("div",{className:"flex-shrink-0 bg-white/95 backdrop-blur-sm border-t border-gray-200",children:[(0,t.jsxs)("div",{className:"px-4 sm:px-6 flex-shrink-0 pb-2 pt-2",children:[(0,t.jsx)(f,{selected:l?["image-gen"]:i,onToggle:m,onUploadClick:u,onRemove:h,onExitImageGen:x}),l&&(0,t.jsxs)("div",{className:"mt-3 p-3 bg-gradient-to-r from-purple-50 to-blue-50 border border-purple-200 rounded-lg",children:[(0,t.jsx)("div",{className:"flex items-center justify-between gap-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-pulse"}),(0,t.jsx)("span",{className:"text-sm font-medium text-purple-700",children:"ðŸŽ¨ Image Generation Mode Active"})]})}),(0,t.jsx)("p",{className:"text-xs text-purple-600 mt-1",children:"Type your image description in the message box below"})]}),o&&(0,t.jsxs)("div",{className:"mt-4 flex items-start gap-4 p-4 bg-blue-50 rounded-xl border border-blue-200",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("img",{src:o,alt:"preview",className:"w-24 h-18 object-cover rounded-lg border border-white shadow-sm"}),(0,t.jsx)("button",{onClick:()=>h("upload"),className:"absolute -top-2 -right-2 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors",children:(0,t.jsx)(n.FiX,{size:10})})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Image attached"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Ready to analyze"})]})]})]}),(0,t.jsx)("div",{className:"px-4 sm:px-6 py-2 sm:py-3 pb-[calc(0.5rem+env(safe-area-inset-bottom))] sm:pb-3",children:(0,t.jsxs)("div",{className:"flex items-end gap-3",children:[(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)("div",{className:"bg-gray-100 rounded-2xl border border-gray-200 focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-100 transition-all",children:(0,t.jsx)("textarea",{value:a,onChange:e=>s(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||r||(e.preventDefault(),c())},disabled:r,placeholder:r?"AI is responding...":l?"ðŸŽ¨ Describe the image you want to generate...":"Message Bharat AI...",rows:1,className:"w-full border-0 bg-transparent px-4 py-3 focus:outline-none resize-none text-gray-800 placeholder-gray-500 ".concat(r?"opacity-50 cursor-not-allowed":""),style:{minHeight:"48px",maxHeight:"150px"}})})}),(0,t.jsx)("button",{onClick:c,disabled:!a.trim()&&!o||r,className:"p-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 group flex-shrink-0",title:r?"AI is responding...":l?"Generate image":"Send message",children:r?(0,t.jsx)("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}):l?(0,t.jsx)("div",{className:"flex items-center gap-1",children:(0,t.jsx)("span",{className:"text-sm",children:"ðŸŽ¨"})}):(0,t.jsx)(n.FiSend,{size:20,className:"group-hover:translate-x-0.5 transition-transform"})})]})}),(0,t.jsx)("input",{ref:d,type:"file",accept:"image/*",className:"hidden",onChange:g})]})}function w(e){let{isOpen:a,onClose:s,onConfirm:r}=e;return a?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-7 w-full max-w-sm border border-gray-200 animate-fadeIn",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,t.jsx)("div",{className:"bg-red-100 text-red-600 rounded-full p-2",children:(0,t.jsx)(n.FiX,{size:22})}),(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Delete Chat?"})]}),(0,t.jsx)("p",{className:"text-gray-600 mb-6 text-sm",children:"Are you sure you want to delete this chat? This action cannot be undone."}),(0,t.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,t.jsx)("button",{onClick:s,className:"px-4 py-2 rounded-lg bg-gray-100 text-gray-700 hover:bg-gray-200 font-medium",children:"Cancel"}),(0,t.jsx)("button",{onClick:r,className:"px-4 py-2 rounded-lg bg-red-600 text-white font-semibold hover:bg-red-700 shadow",autoFocus:!0,children:"Delete"})]})]})}):null}function v(e){let{onClick:a,show:s}=e;return s?(0,t.jsxs)("button",{onClick:a,className:"fixed bottom-24 right-4 sm:right-8 z-10 bg-blue-600 hover:bg-blue-700 text-white rounded-full p-3 shadow-lg transition-all duration-300 animate-fadeIn flex items-center justify-center group","aria-label":"Scroll to bottom",title:"Scroll to bottom",children:[(0,t.jsx)(n.FiArrowDown,{size:20,className:"group-hover:translate-y-0.5 transition-transform"}),(0,t.jsx)("span",{className:"absolute -top-8 left-1/2 -translate-x-1/2 bg-gray-900 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:"New messages"})]}):null}function y(){return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})})}function j(){return(0,t.jsx)("div",{className:"absolute inset-0 bg-white/90 backdrop-blur-sm z-30 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center max-w-md mx-auto px-6",children:[(0,t.jsxs)("div",{className:"relative mb-6",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mx-auto flex items-center justify-center animate-pulse",children:(0,t.jsx)("svg",{className:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})})}),(0,t.jsx)("div",{className:"absolute inset-0 w-16 h-16 border-4 border-blue-200 rounded-full mx-auto animate-spin border-t-transparent"})]}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Setting up your chat..."}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"BharatAI is processing your message and preparing a response."}),(0,t.jsxs)("div",{className:"flex justify-center space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,t.jsx)("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,t.jsx)("div",{className:"w-2 h-2 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})})}function N(){return(0,t.jsx)("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading chat..."})]})})}var k=e.i(59392);function C(){let e=(0,s.useRouter)(),n=(0,s.useSearchParams)(),{data:i,status:o}=(0,r.useSession)(),[d,m]=(0,a.useState)(""),[x,g]=(0,a.useState)([]),[f,N]=(0,a.useState)([]),[C,I]=(0,a.useState)(null),[S,E]=(0,a.useState)(!1),[M,D]=(0,a.useState)(null),[T,z]=(0,a.useState)(!1),[L,A]=(0,a.useState)(!1),[R,F]=(0,a.useState)(!1),[U,O]=(0,a.useState)({isOpen:!1,imageUrl:null}),[P,B]=(0,a.useState)({open:!1,chatId:null}),{userAvatar:G,userName:H}=function(){var e;let{data:t}=(0,r.useSession)(),[s,n]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=async()=>{if(null==t?void 0:t.user)try{let e=await fetch("/api/user/profile",{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(e.ok){let t=await e.json();n(t.user.image)}}catch(e){console.error("Error loading user profile:",e),n(t.user.image)}};(null==t?void 0:t.user)&&e();let a=()=>{(null==t?void 0:t.user)&&e()},s=()=>{"visible"===document.visibilityState&&(null==t?void 0:t.user)&&e()};return window.addEventListener("focus",a),document.addEventListener("visibilitychange",s),()=>{window.removeEventListener("focus",a),document.removeEventListener("visibilitychange",s)}},[t]),{userAvatar:s,userName:null==t||null==(e=t.user)?void 0:e.name}}(),{chats:W,setChats:V,isLoadingChats:X}=function(){let{data:e}=(0,r.useSession)(),[t,s]=(0,a.useState)([]),[n,l]=(0,a.useState)(!0);return(0,a.useEffect)(()=>{let t=async()=>{if(null==e?void 0:e.user)try{let e=await fetch("/api/chats");if(e.ok){let t=(await e.json()).chats.filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id));s(t)}}catch(e){console.error("Error loading chats:",e)}finally{l(!1)}};(null==e?void 0:e.user)&&t()},[e]),{chats:t,setChats:s,isLoadingChats:n}}(),{scrollRef:J,typingRef:K,lastMessageRef:q,messagesEndRef:_,scrollToBottom:Y,showScrollButton:Q}=function(e,t){let s=(0,a.useRef)(null),r=(0,a.useRef)(null),n=(0,a.useRef)(null),l=(0,a.useRef)(null),[i,o]=(0,a.useState)(!1),d=(0,a.useRef)(0),c=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{let e=l.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:a,clientHeight:s}=e;o(!(100>Math.abs(a-s-t)))};return e.addEventListener("scroll",t),t(),()=>{e.removeEventListener("scroll",t)}},[]),(0,a.useEffect)(()=>{let a=l.current;if(!a)return;let i=a.scrollHeight,m=d.current;if(i>m&&m>0){let{scrollTop:l,scrollHeight:i,clientHeight:d}=a,m=100>Math.abs(i-d-l);c.current&&m?setTimeout(()=>{var e;null==(e=n.current)||e.scrollIntoView({behavior:"smooth",block:"end"}),c.current=!1},50):e&&s.current?setTimeout(()=>{var e;null==(e=s.current)||e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100):!e&&r.current&&t.length>0?setTimeout(()=>{var e;null==(e=r.current)||e.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100):m||o(!0)}d.current=i},[t.length,e]),{scrollRef:l,typingRef:s,lastMessageRef:r,messagesEndRef:n,scrollToBottom:function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l.current&&(t&&(c.current=!0),e&&n.current?n.current.scrollIntoView({behavior:"smooth",block:"end"}):l.current.scrollTop=l.current.scrollHeight,o(!1))},showScrollButton:i}}(T,x),{handleImageGeneration:Z,handleSendMessage:$,loadChatMessages:ee,deleteChat:et}={handleImageGeneration:async e=>{z(!0);try{let a={id:"temp-".concat(Date.now()),role:"user",content:"ðŸŽ¨ Generate image: ".concat(e),timestamp:new Date};g(e=>[...e,a]);let s=await fetch("/api/generate-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,model:"stable-diffusion",size:"1024x1024"})});if(s.ok){var t;let r=await s.json(),n={id:"ai-".concat(Date.now()),role:"assistant",content:"I've generated an image based on your prompt: \"".concat(e,'"'),image:{url:r.image.url},timestamp:new Date};g(e=>[...e.filter(e=>e.id!==a.id),a,n]);try{let t=await fetch("/api/chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"ðŸŽ¨ Generate image: ".concat(e),chatId:M,generatedImageUrl:r.image.url})});if(t.ok){let a=await t.json();if(g(t=>{let s={id:a.userMessage.id,role:a.userMessage.role,content:"ðŸŽ¨ Generate image: ".concat(e),image:a.userMessage.image,timestamp:a.userMessage.timestamp},r={id:a.assistantMessage.id,role:a.assistantMessage.role,content:"I've generated an image based on your prompt: \"".concat(e,'"'),image:a.assistantMessage.image,timestamp:a.assistantMessage.timestamp};return[...t.filter(e=>!e.id.startsWith("temp-")&&!e.id.startsWith("ai-")&&e.id!==s.id&&e.id!==r.id),s,r]}),a.isNewChat){let t={id:a.chatId,title:a.chatTitle,messageCount:2,lastMessage:"Generated image: ".concat(e.slice(0,50),"..."),createdAt:new Date,updatedAt:new Date};V(e=>{let s=e.filter(e=>e.id!==a.chatId);return[t,...s]}),D(a.chatId);{let e=new URL(window.location.href);e.searchParams.set("chatId",a.chatId),window.history.replaceState({},"",e.pathname+e.search)}}else V(t=>t.map(t=>t.id===M?{...t,messageCount:t.messageCount+2,lastMessage:"Generated image: ".concat(e.slice(0,50),"..."),updatedAt:new Date}:t))}}catch(e){console.error("Error saving to chat:",e)}return{success:!0,chatId:(null==(t=chatData)?void 0:t.chatId)||M}}{let e=await s.json();return g(e=>e.filter(e=>e.id!==a.id)),(0,k.errorToast)(e.error||"Failed to generate image"),{success:!1}}}catch(e){return console.error("Error generating image:",e),g(e=>e.filter(e=>e.id.startsWith("temp-"))),(0,k.errorToast)("An error occurred while generating the image."),{success:!1}}finally{z(!1)}},handleSendMessage:async(e,t)=>{if(!e.trim()&&!t)return!1;z(!0);try{let a=null;if(t)try{let e=await fetch(t),s=await e.blob();a={data:await new Promise((e,t)=>{let a=new FileReader;a.onloadend=()=>{let t=a.result.split(",")[1];e(t)},a.onerror=t,a.readAsDataURL(s)}),type:s.type}}catch(e){return console.error("Error processing image:",e),(0,k.errorToast)("Failed to process image. Please try again."),z(!1),{success:!1}}let s={id:"temp-".concat(Date.now()),role:"user",content:e,image:t?{url:t}:void 0,timestamp:new Date};g(e=>[...e,s]);let r=await fetch("/api/chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,chatId:M,imageData:a}),signal:AbortSignal.timeout(6e4)});if(r.ok){let e=await r.json();if(g(t=>[...t.filter(t=>t.id!==s.id&&t.id!==e.userMessage.id&&t.id!==e.assistantMessage.id),e.userMessage,e.assistantMessage]),e.isNewChat){let t={id:e.chatId,title:e.chatTitle,messageCount:2,lastMessage:e.assistantMessage.content.slice(0,100),createdAt:new Date,updatedAt:new Date};V(a=>{let s=a.filter(t=>t.id!==e.chatId);return[t,...s]}),D(e.chatId);{let t=new URL(window.location.href);t.searchParams.set("chatId",e.chatId),window.history.replaceState({},"",t.pathname+t.search)}}else V(t=>t.map(t=>t.id===e.chatId?{...t,messageCount:t.messageCount+2,lastMessage:e.assistantMessage.content.slice(0,100),updatedAt:new Date}:t));return{success:!0,chatId:e.chatId,isNewChat:e.isNewChat}}{let e="Failed to send message. Please try again.";try{let t=await r.json();t.error&&(e=t.error)}catch(e){}return g(e=>e.filter(e=>e.id!==s.id)),(0,k.errorToast)(e),{success:!1}}}catch(t){var a,s;console.error("Error sending message:",t),g(e=>e.filter(e=>e.id.startsWith("temp-")));let e="An error occurred while sending your message.";return"AbortError"===t.name||"TimeoutError"===t.name?e="Request timed out. Please check your connection and try again.":((null==(a=t.message)?void 0:a.includes("network"))||(null==(s=t.message)?void 0:s.includes("fetch")))&&(e="Network error. Please check your internet connection."),(0,k.errorToast)(e),{success:!1}}finally{z(!1)}},loadChatMessages:async e=>{try{let t=await fetch("/api/chats/".concat(e));if(t.ok){let a=await t.json();return D(e),g(a.chat.messages),!0}return!1}catch(e){return console.error("Error loading chat messages:",e),!1}},deleteChat:async e=>{try{if((await fetch("/api/chats?chatId=".concat(e),{method:"DELETE"})).ok)return!0;return(0,k.errorToast)("Failed to delete chat. Please try again."),!1}catch(e){return console.error("Error deleting chat:",e),(0,k.errorToast)("An error occurred while deleting the chat."),!1}}},ea=(0,a.useRef)(null),es=(0,a.useRef)(!1);if((0,a.useEffect)(()=>{"unauthenticated"===o&&e.push("/login?callbackUrl=/chat")},[o,e]),(0,a.useEffect)(()=>{(async()=>{if(es.current||!(null==i?void 0:i.user)||X)return;let e=n.get("chatId");if(e){es.current=!0,window.dispatchEvent(new Event("topLoadingBar:start"));try{await ee(e)}finally{window.dispatchEvent(new Event("topLoadingBar:complete"))}}})()},[n,i,X,ee]),(0,a.useEffect)(()=>{(async()=>{if(es.current||!(null==i?void 0:i.user))return;let e=n.get("message"),t=n.get("chatId");if(e&&!t&&!X){es.current=!0,F(!0),g([{id:"temp-user-".concat(Date.now()),role:"user",content:e,timestamp:new Date}]),z(!0);try{let t=await fetch("/api/chats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e}),signal:AbortSignal.timeout(6e4)});if(t.ok){let e=await t.json(),a={id:e.chatId,title:e.chatTitle,messageCount:2,lastMessage:e.assistantMessage.content.slice(0,100),createdAt:new Date,updatedAt:new Date};V(e=>[a,...e]),D(e.chatId),g([e.userMessage,e.assistantMessage]);{let t=new URL(window.location.href);t.searchParams.set("chatId",e.chatId),t.searchParams.delete("message"),window.history.replaceState({},"",t.pathname+t.search)}}else g([]),console.error("Error sending initial message")}catch(e){console.error("Error sending initial message:",e),g([])}finally{z(!1),F(!1)}{let e=new URL(window.location.href);e.searchParams.delete("message"),window.history.replaceState({},"",e.pathname+e.search)}}})()},[n,i,X,V,D]),"loading"===o)return(0,t.jsx)(y,{});if("unauthenticated"===o)return null;let er=async()=>{if(!d.trim()&&!C)return;let e=d.trim();m(""),Y(!0,!0),L?(await Z(e),A(!1)):await $(e,C)&&C&&(URL.revokeObjectURL(C),I(null),N(e=>e.filter(e=>"upload"!==e)))},en=async e=>{if(e===M)return void E(!1);window.dispatchEvent(new Event("topLoadingBar:start"));try{await ee(e),I(null),N([]),E(!1);{let t=new URL(window.location.href);t.searchParams.set("chatId",e),window.history.replaceState({},"",t.pathname+t.search)}}finally{window.dispatchEvent(new Event("topLoadingBar:complete"))}},el=()=>{B({open:!1,chatId:null})},ei=async()=>{let e=P.chatId;if(await et(e)){let t=W.filter(t=>t.id!==e);V(t),M===e&&(t.length>0?await ee(t[0].id):(D(null),g([])))}el()};return(0,t.jsxs)("div",{className:"h-[100dvh] bg-gray-50 flex relative overflow-hidden",children:[(0,t.jsx)(c,{isOpen:S,onClose:()=>E(!1),chats:W,currentChatId:M,onNewChat:()=>{D(null),g([]),I(null),N([]),E(!1);{let e=new URL(window.location.href);e.searchParams.delete("chatId"),window.history.replaceState({},"",e.pathname+e.search)}},onSelectChat:en,onDeleteChat:e=>{B({open:!0,chatId:e})},onOpenSettings:()=>e.push("/setting")}),(0,t.jsxs)("div",{className:"flex-1 flex flex-col w-full lg:w-auto h-full min-h-0",children:[R&&1===x.length&&(0,t.jsx)(j,{}),(0,t.jsx)(u,{onMenuClick:()=>E(!0),onProfileClick:()=>e.push("/profile"),userAvatar:G,userName:H}),0!==x.length||T?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p,{messages:x,isTyping:T,typingRef:K,lastMessageRef:q,messagesEndRef:_,scrollRef:J,onImageClick:e=>{O({isOpen:!0,imageUrl:e})}}),(0,t.jsx)(v,{show:Q,onClick:()=>Y(!0)})]}):(0,t.jsx)(h,{}),(0,t.jsx)(b,{message:d,setMessage:m,isTyping:T,isImageGenMode:L,selectedTools:f,uploadedPreview:C,fileRef:ea,onSend:er,onToggleTool:e=>{"image-gen"===e?(A(!L),L||(N([]),I(null))):(A(!1),N(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]))},onUploadClick:()=>{ea.current&&ea.current.click()},onRemoveTool:e=>{N(t=>t.filter(t=>t!==e)),"upload"===e&&C&&(URL.revokeObjectURL(C),I(null))},onExitImageGen:()=>{A(!1),m("")},onFileChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&(I(URL.createObjectURL(a)),N(e=>e.includes("upload")?e:[...e,"upload"]),e.target.value="")}})]}),(0,t.jsx)(w,{isOpen:P.open,onClose:el,onConfirm:ei}),(0,t.jsx)(l,{isOpen:U.isOpen,onClose:()=>{O({isOpen:!1,imageUrl:null})},imageUrl:U.imageUrl})]})}function I(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)(N,{}),children:(0,t.jsx)(C,{})})}}]);